<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>防詐數據視覺化體驗平台</title>
  <style>
    body { font-family: "Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin:0; background:#fafafa; color:#333 }
    header { background:#f7b500; color:#fff; padding:16px 12px; text-align:center }
    main { max-width:900px; margin:24px auto; padding:0 16px }
    section { display:none; background:#fff; padding:20px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,.06) }
    section.active { display:block }
    h1,h2 { margin:0 0 12px }
    nav#breadcrumb { font-size:13px; opacity:.9 }
    label { display:block; margin:12px 0 }
    input, select, textarea, button { width:100%; font-size:16px; padding:10px 12px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box }
    textarea { min-height:96px }
    button { background:#f7b500; color:#fff; border:none; cursor:pointer }
    button[disabled] { opacity:.6; cursor:not-allowed }
    button:hover { background:#e09e00 }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:12px }
    .button-row { display:flex; gap:12px; justify-content:space-between }
    progress { width:100%; height:16px; margin:8px 0 12px }
    #chart-area img { max-width:100%; border-radius:10px; cursor:zoom-in; }
    #slider-wrap { display:none; text-align:center; gap:8px; align-items:center; margin-top:10px }
    #slider-value { min-width:48px; display:inline-block }
    table { width:100%; border-collapse:collapse; margin:10px 0 18px }
    th, td { border:1px solid #eaeaea; padding:8px; text-align:center }
    th { background:#fff3cd }
    .callout { background:#fffbe6; border:1px solid #ffe58f; padding:12px; border-radius:10px; font-size:14px }
    .muted { color:#777; font-size:13px }
    .success { color:#0a7a28 }
    dialog img { max-width:90vw; max-height:90vh }
  </style>
</head>

<body>
  <header>
    <h1>防詐數據視覺化體驗平台</h1>
    <nav id="breadcrumb">資料 → 作答 → 問卷 → 送出</nav>
  </header>

  <main>
    <!-- ========== 1) 目標與授權 ========== -->
    <section id="conf-section" class="active">
      <h2>1) 目標與資料授權</h2>
      <p class="callout">此頁面會在本機紀錄你的作答，完成後由系統送到研究團隊的試算表。送出後不會收集個資，僅包含你輸入的 pid、年齡、性別與作答內容。</p>
      <div class="row">
        <label>（可留空自動產生）參與者編號 pid<input id="pid" placeholder="例如：P01" /></label>
        <label>年齡<input id="age" type="number" min="18" max="99" /></label>
      </div>
      <div class="row">
        <label>性別
          <select id="gender">
            <option value="">請選擇</option>
            <option value="M">男性</option>
            <option value="F">女性</option>
          </select>
        </label>
        <label class="muted">裝置資訊（自動偵測）<input id="device" disabled /></label>
      </div>
      <button id="start-btn">我了解並開始</button>
    </section>

    <!-- ========== 2) 題目區 ========== -->
    <section id="trial-section">
      <h2 id="trial-title">2) 題目 1 / 6</h2>
      <progress id="progress" value="1" max="6"></progress>
      <div id="chart-area"><img id="chart-image" alt="chart" /></div>
      <p id="question-text"></p>
      <input id="response" placeholder="請輸入答案" />
      <div id="slider-wrap"><input type="range" id="slider" min="80" max="160" value="120" /><span id="slider-value">120</span></div>

      <div class="button-row">
        <button id="prev-btn">上一題</button>
        <button id="next-btn">下一題</button>
      </div>
    </section>

    <!-- ========== 3) 主觀問卷 ========== -->
    <section id="survey-section">
      <h2>3) 主觀問卷</h2>
      <div id="survey-forms"></div>

      <div class="row">
        <label>最偏好圖表類型
          <select id="preference">
            <option value="">請選擇</option>
            <option value="line">折線圖</option>
            <option value="bar">長條圖</option>
            <option value="heat">熱點圖</option>
          </select>
        </label>

        <label>其他意見<textarea id="open-feedback" placeholder="（選填）"></textarea></label>
      </div>

      <button id="finish-btn">完成</button>
    </section>

    <!-- ========== 4) 送出 ========== -->
    <section id="done-section">
      <h2>4) 送出</h2>
      <p id="status" class="muted">尚未送出</p>
      <div class="row">
        <button id="send-sheets">送出作答</button>
        <button id="restart-btn" style="display:none; background:#666">重新作答</button>
      </div>
    </section>
  </main>

  <!-- 放大圖片 dialog -->
  <dialog id="img-dialog"><img id="dialog-img" /></dialog>

  <script>
    /* === 省略前面：常數設定、TASKS、工具函式（保持不變） === */

    const SURVEY_DIMENSIONS = ['易讀性','反應速度','信心程度','風險理解度'];

    /* === ✨ 修改後的 buildSurvey()：加入圖表圖片 ✨ === */
    function buildSurvey(){
      const host = document.querySelector('#survey-forms');
      host.innerHTML = '';

      const chartImages = {
        line: 'assets/line_trend_1920x1080b.png',
        bar:  'assets/bar_top10_1920x1080b.png',
        heat: 'assets/heat_month_1920x1080b.png'
      };

      ['line','bar','heat'].forEach(type => {
        let html = `
          <div style="text-align:center; margin-top:24px;">
            <img src="${chartImages[type]}" 
                 alt="${type} chart" 
                 style="max-width:80%; border-radius:10px; border:1px solid #ccc; margin-bottom:12px;">
          </div>

          <table>
            <tr><th colspan="6">${type.toUpperCase()} 圖表評分</th></tr>
            <tr><th>構面</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
        `;

        SURVEY_DIMENSIONS.forEach((d,i) => {
          html += `<tr><td>${d}</td>` +
            [1,2,3,4,5].map(v =>
              `<td><input type="radio" name="${type}_${i+1}" value="${v}"></td>`
            ).join('') +
            '</tr>';
        });

        html += `</table>`;
        host.insertAdjacentHTML('beforeend', html);
      });
    }

    /* === 其餘程式（startExp, nextTrial, finishSurvey, sendToSheets…）完全不變 === */
  </script>
</body>
</html>

